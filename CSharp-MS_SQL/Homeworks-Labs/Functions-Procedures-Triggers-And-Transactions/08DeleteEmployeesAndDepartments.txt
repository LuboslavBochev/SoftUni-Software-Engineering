CREATE PROC usp_DeleteEmployeesFromDepartment @departmentId INT
AS
BEGIN
	ALTER TABLE Departments ALTER COLUMN ManagerID INT NULL
	
	ALTER TABLE Departments DROP 
	CONSTRAINT FK_Departments_Employees;

	ALTER TABLE Employees DROP 
	CONSTRAINT FK_Employees_Departments;

	ALTER TABLE Employees DROP 
	CONSTRAINT FK_Employees_Employees;

	ALTER TABLE Departments
	ADD CONSTRAINT FK_Departments_Employees
	FOREIGN KEY (ManagerID) 
	REFERENCES Employees (EmployeeID) ON DELETE CASCADE 

	ALTER TABLE Employees
	ADD CONSTRAINT FK_Employees_Departments
	FOREIGN KEY (DepartmentID) 
	REFERENCES Departments (DepartmentID) ON DELETE CASCADE 

	ALTER TABLE Employees
	ADD CONSTRAINT FK_Employees_Employees
	FOREIGN KEY (ManagerID) 
	REFERENCES Employees (EmployeeID) ON DELETE CASCADE 

	DELETE FROM Employees WHERE DepartmentID = @departmentId
	DELETE FROM Departments WHERE DepartmentID = @departmentId
	SELECT COUNT(*) FROM Employees WHERE DepartmentID = @departmentId
	
END;